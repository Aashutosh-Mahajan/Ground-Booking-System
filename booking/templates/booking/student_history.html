{% extends 'base.html' %}
{% load static %}
{% block title %}My Booking History{% endblock %}

{% block content %}
<div class="container">
  <div class="section-header" style="margin-top: 1rem; margin-bottom: 1rem;">
    <h1 class="dashboard-title">My Booking History</h1>
    <p class="dashboard-subtitle">View your past and current bookings and their status</p>
  </div>

  <div class="card" style="padding: 1rem;">
    <form method="get" class="filters" style="margin-bottom: 1rem; display: flex; gap: .5rem; align-items: center; flex-wrap: wrap;">
      <label for="status" style="font-weight: 600;">Status</label>
      <select name="status" id="status" onchange="this.form.submit()">
        <option value="" {% if not status_filter %}selected{% endif %}>All</option>
        <option value="Pending" {% if status_filter == 'Pending' %}selected{% endif %}>Pending</option>
        <option value="Approved" {% if status_filter == 'Approved' %}selected{% endif %}>Approved</option>
        <option value="Rejected" {% if status_filter == 'Rejected' %}selected{% endif %}>Rejected</option>
      </select>
    </form>

    {% if page_obj.object_list %}
      <div class="table-responsive">
        <table class="table" style="width:100%; border-collapse: collapse;">
          <thead>
            <tr>
              <th style="text-align:left; padding:.5rem; border-bottom:1px solid #e5e7eb;">Date</th>
              <th style="text-align:left; padding:.5rem; border-bottom:1px solid #e5e7eb;">Ground</th>
              <th style="text-align:left; padding:.5rem; border-bottom:1px solid #e5e7eb;">Sport</th>
              <th style="text-align:left; padding:.5rem; border-bottom:1px solid #e5e7eb;">Time Slot</th>
              <th style="text-align:left; padding:.5rem; border-bottom:1px solid #e5e7eb;">Players</th>
              <th style="text-align:left; padding:.5rem; border-bottom:1px solid #e5e7eb;">Status</th>
            </tr>
          </thead>
          <tbody>
            {% for b in page_obj.object_list %}
              <tr>
                <td style="padding:.5rem; border-bottom:1px solid #f3f4f6;">{{ b.date }}</td>
                <td style="padding:.5rem; border-bottom:1px solid #f3f4f6;">{{ b.ground }}</td>
                <td style="padding:.5rem; border-bottom:1px solid #f3f4f6;">{{ b.sport|default:'â€”' }}</td>
                <td style="padding:.5rem; border-bottom:1px solid #f3f4f6;">{{ b.time_slot }}</td>
                <td style="padding:.5rem; border-bottom:1px solid #f3f4f6;">{{ b.players.count }}</td>
                <td style="padding:.5rem; border-bottom:1px solid #f3f4f6;">
                  {% if b.status == 'Approved' %}
                    <span style="background:#dcfce7; color:#166534; padding:.2rem .5rem; border-radius:.375rem; font-weight:600;">Approved</span>
                  {% elif b.status == 'Rejected' %}
                    <span style="background:#fee2e2; color:#991b1b; padding:.2rem .5rem; border-radius:.375rem; font-weight:600;">Rejected</span>
                  {% else %}
                    <span style="background:#fef9c3; color:#854d0e; padding:.2rem .5rem; border-radius:.375rem; font-weight:600;">Pending</span>
                  {% endif %}
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      {% if page_obj.paginator.num_pages > 1 %}
      <div class="pagination" style="display:flex; gap:.5rem; align-items:center; margin-top:1rem;">
        {% if page_obj.has_previous %}
          <a class="btn" href="?page={{ page_obj.previous_page_number }}{% if status_filter %}&status={{ status_filter }}{% endif %}">Previous</a>
        {% else %}
          <span class="btn" style="opacity:.5; pointer-events:none;">Previous</span>
        {% endif %}

        <span>Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>

        {% if page_obj.has_next %}
          <a class="btn" href="?page={{ page_obj.next_page_number }}{% if status_filter %}&status={{ status_filter }}{% endif %}">Next</a>
        {% else %}
          <span class="btn" style="opacity:.5; pointer-events:none;">Next</span>
        {% endif %}
      </div>
      {% endif %}

    {% else %}
      <div class="empty-state" style="padding:1rem; color:#6b7280;">
        No bookings found yet.
      </div>
    {% endif %}
  </div>
</div>
{% endblock %}
