{% extends 'base.html' %}
{% block title %}Book Ground{% endblock %}
{% block content %}
<div class="max-w-4xl mx-auto py-12 px-4">
    <div class="card">
        <h2 class="text-3xl font-bold text-gray-900 mb-8 text-center">Book a Ground</h2>

        <form method="POST" action="{% url 'student-booking' %}" class="space-y-6">
            {% csrf_token %}
            
            <!-- Student Information -->
            <div class="grid grid-cols-2 gap-6">
                <div class="form-group">
                    <label for="id_student_name" class="form-label">Full Name</label>
                    {{ booking_form.student_name }}
                </div>
                <div class="form-group">
                    <label for="id_roll_number" class="form-label">Roll Number</label>
                    {{ booking_form.roll_number }}
                </div>
            </div>
            <div class="grid grid-cols-3 gap-6">
                <div class="form-group">
                    <label for="id_student_branch" class="form-label">Branch</label>
                    {{ booking_form.student_branch }}
                </div>
                <div class="form-group">
                    <label for="id_student_year" class="form-label">Year</label>
                    {{ booking_form.student_year }}
                </div>
                <div class="form-group">
                    <label for="id_student_division" class="form-label">Division</label>
                    {{ booking_form.student_division }}
                </div>
            </div>

            <!-- Ground and Date Selection -->
            <div class="grid grid-cols-2 gap-6">
                <div class="form-group">
                    <label for="id_ground" class="form-label">Ground Selection</label>
                    <select name="ground" id="id_ground" class="form-select">
                        <option value="">Select a ground</option>
                        <option value="Ground A">Ground A</option>
                        <option value="Ground B">Ground B</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="id_date" class="form-label">Date</label>
                    {{ booking_form.date }}
                </div>
            </div>

            <!-- Time Slot and Number of Players -->
            <div class="grid grid-cols-2 gap-6">
                <div class="form-group">
                    <label for="id_time_slot" class="form-label">Time Slot</label>
                    <select name="time_slot" id="id_time_slot" class="form-select">
                        <option value="">Select time slot</option>
                        <option value="9.00 - 11.00">9.00 - 11.00</option>
                        <option value="11.00 - 13.00">11.00 - 13.00</option>
                        <option value="13.00 - 15.00">13.00 - 15.00</option>
                        <option value="15.00 - 17.00">15.00 - 17.00</option>
                        <option value="17.00 - 19.00">17.00 - 19.00</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="id_number_of_players" class="form-label">Number of Players</label>
                    <select name="number_of_players" id="id_number_of_players" class="form-select">
                        <option value="1" selected>1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10</option>
                        <option value="11">11</option>
                    </select>
                </div>
            </div>

            <!-- Purpose -->
            <div class="form-group">
                <label for="id_purpose" class="form-label">Purpose</label>
                {{ booking_form.purpose }}
            </div>

            <!-- Player Information (Dynamic) -->
            <div id="players-container" class="space-y-4">
                <!-- Player forms will be generated here -->
            </div>

            <button type="submit" class="btn btn-primary btn-full">
                Submit Booking Request
            </button>
        </form>

        {% if success %}
            <div class="mt-6 text-green-600 text-center font-semibold">
                {{ success }}
            </div>
        {% endif %}
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const numPlayersSelect = document.getElementById('id_number_of_players');
    const playersContainer = document.getElementById('players-container');

    function generatePlayerForms(count) {
        playersContainer.innerHTML = '';
        
        for (let i = 1; i <= count; i++) {
            const playerForm = document.createElement('div');
            playerForm.className = 'player-form';
            playerForm.innerHTML = `
                <h3 class="text-lg font-semibold mb-4">Player ${i}</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div class="form-group">
                        <label class="form-label">Name</label>
                        <input type="text" name="player${i}_name" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Branch</label>
                        <select name="player${i}_branch" class="form-select" required>
                            <option value="">Select Branch</option>
                            <option value="CSE">CSE</option>
                            <option value="IT">IT</option>
                            <option value="EXCS">EXCS</option>
                            <option value="EXTC">EXTC</option>
                            <option value="BIOM">BIOM</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Year</label>
                        <select name="player${i}_year" class="form-select" required>
                            <option value="">Select Year</option>
                            <option value="FE">FE</option>
                            <option value="SE">SE</option>
                            <option value="TE">TE</option>
                            <option value="BE">BE</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Division</label>
                        <select name="player${i}_division" class="form-select" required>
                            <option value="">Select Division</option>
                            <option value="A">A</option>
                            <option value="B">B</option>
                            <option value="C">C</option>
                        </select>
                    </div>
                </div>
            `;
            playersContainer.appendChild(playerForm);
        }
    }

    // Ensure a default of 1 player displayed
    if (!numPlayersSelect.value) {
        numPlayersSelect.value = '1';
    }
    generatePlayerForms(parseInt(numPlayersSelect.value));

    // Update player forms when selection changes
    numPlayersSelect.addEventListener('change', function() {
        const count = parseInt(this.value) || 0;
        generatePlayerForms(count);
    });

});
</script>
{% endblock %}
