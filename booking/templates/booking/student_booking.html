{% extends 'base.html' %}
{% block title %}Book Ground{% endblock %}
{% block content %}

<div class="max-w-4xl mx-auto py-12 px-4">
    <div class="card">
        <h2 class="text-3xl font-bold text-gray-900 mb-8 text-center">Book a Ground</h2>

        <form method="POST" action="{% url 'student_booking' %}" class="space-y-6">
            {% csrf_token %}

            <!-- Step 1 hidden inputs -->
            <input type="hidden" name="date" value="{{ request.GET.date }}">
            <input type="hidden" name="ground" value="{{ request.GET.ground }}">
            <input type="hidden" name="sport" value="{{ request.GET.sport }}">
            <input type="hidden" name="time_slot" value="{{ request.GET.time_slot }}">

            <!-- Optional summary of Step 1 selections -->
            <div class="booking-summary">
                <p><strong>Date:</strong> {{ request.GET.date }}</p>
                <p><strong>Ground:</strong> {{ request.GET.ground }}</p>
                <p><strong>Sport:</strong> {{ request.GET.sport }}</p>
                <p><strong>Time Slot:</strong> {{ request.GET.time_slot }}</p>
            </div>

            <!-- Student Information -->
            <div class="grid grid-cols-2 gap-6">
                <div class="form-group">
                    <label class="form-label">Full Name</label>
                    {{ booking_form.student_name }}
                </div>
                <div class="form-group">
                    <label class="form-label">Roll Number</label>
                    {{ booking_form.roll_number }}
                </div>
                <div class="form-group">
                    <label class="form-label">Email Address</label>
                    {{ booking_form.student_email }}
                </div>
            </div>

            <!-- Branch, Year, Division -->
            <div class="grid grid-cols-3 gap-6">
                <div class="form-group">
                    <label class="form-label">Branch</label>
                    <select name="student_branch" class="form-select" required>
                        <option value="">Select Branch</option>
                        <option value="INFT">INFT</option>
                        <option value="CMPN">CMPN</option>
                        <option value="EXTC">EXTC</option>
                        <option value="EXCS">EXCS</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Year</label>
                    <select name="student_year" class="form-select" required>
                        <option value="">Select Year</option>
                        <option value="1st Year">1st Year</option>
                        <option value="2nd Year">2nd Year</option>
                        <option value="3rd Year">3rd Year</option>
                        <option value="4th Year">4th Year</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Division</label>
                    <select name="student_division" class="form-select" required>
                        <option value="">Select Division</option>
                        <option value="A">A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>
                    </select>
                </div>
            </div>

            <!-- Number of Players -->
            <div class="grid grid-cols-2 gap-6">
                <div class="form-group">
                    <label class="form-label">Number of Players</label>
                    <select name="number_of_players" id="id_number_of_players" class="form-select">
                        {% for i in number_options %}
                            <option value="{{ i }}" {% if i == 1 %}selected{% endif %}>{{ i }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <!-- Purpose -->
            <div class="form-group">
                <label class="form-label">Purpose</label>
                {{ booking_form.purpose }}
            </div>

            <!-- Dynamic Player Forms -->
            <div id="players-container" class="space-y-4"></div>

            <!-- Submit -->
            <button type="submit" class="btn btn-primary btn-full">
                Submit Booking Request
            </button>
        </form>
    </div>
</div>

<!-- Dynamic Player Form Script -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const numPlayersSelect = document.getElementById('id_number_of_players');
    const playersContainer = document.getElementById('players-container');

    function generatePlayerForms(count) {
        playersContainer.innerHTML = '';
        for (let i = 1; i <= count; i++) {
            const playerForm = document.createElement('div');
            playerForm.className = 'player-form';
            playerForm.innerHTML = `
                <h3 class="text-lg font-semibold mb-4">Player ${i}</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div class="form-group">
                        <label class="form-label">Name</label>
                        <input type="text" name="player${i}_name" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Branch</label>
                        <select name="player${i}_branch" class="form-select" required>
                            <option value="">Select Branch</option>
                            <option value="INFT">INFT</option>
                            <option value="CMPN">CMPN</option>
                            <option value="EXTC">EXTC</option>
                            <option value="EXCS">EXCS</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Year</label>
                        <select name="player${i}_year" class="form-select" required>
                            <option value="">Select Year</option>
                            <option value="1st Year">1st Year</option>
                            <option value="2nd Year">2nd Year</option>
                            <option value="3rd Year">3rd Year</option>
                            <option value="4th Year">4th Year</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Division</label>
                        <select name="player${i}_division" class="form-select" required>
                            <option value="">Select Division</option>
                            <option value="A">A</option>
                            <option value="B">B</option>
                            <option value="C">C</option>
                        </select>
                    </div>
                </div>`;
            playersContainer.appendChild(playerForm);
        }
    }

    generatePlayerForms(parseInt(numPlayersSelect.value) || 1);

    numPlayersSelect.addEventListener('change', function() {
        generatePlayerForms(parseInt(this.value) || 1);
    });
});
</script>
{% endblock %}
