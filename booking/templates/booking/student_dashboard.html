{% extends 'base.html' %}
{% load static %}
{% block title %}Student Dashboard{% endblock %}

{% block content %}
<div class="min-h-screen bg-slate-50 pt-24 pb-6 md:pt-28 md:pb-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="mb-8 md:mb-12 text-center">
            <h1 class="text-3xl md:text-4xl font-bold font-heading text-slate-900 mb-2 md:mb-4">Student Dashboard</h1>
            <p class="text-base md:text-lg text-slate-600">Book your sports facilities with ease</p>
        </div>

        <!-- Welcome Message -->
        <div class="bg-white rounded-3xl shadow-xl overflow-hidden mb-8 md:mb-12 relative">
            <div class="absolute inset-0 bg-gradient-to-r from-primary-600 to-primary-800 opacity-90"></div>
            <div class="absolute inset-0 bg-[url('{% static 'images/pattern.svg' %}')] opacity-10"></div>
            <div class="relative z-10 p-6 md:p-12 flex flex-col md:flex-row items-center justify-between gap-6 md:gap-8">
                <div class="text-white text-center md:text-left">
                    <h2 class="text-2xl md:text-3xl font-bold font-heading mb-2">Welcome, {{ first_name }}!</h2>
                    <p class="text-primary-100 text-base md:text-lg">Ready to book your favorite sports facility?</p>
                </div>
                <div class="hidden md:block">
                    <img src="{% static 'images/VitGround1.jpg' %}" alt="Sports Ground" class="w-64 h-40 object-cover rounded-2xl shadow-lg border-4 border-white/20 transform rotate-3 hover:rotate-0 transition-transform duration-500">
                </div>
            </div>
        </div>

        <!-- Progress Steps -->
        <div class="mb-8 md:mb-12">
            <div class="flex justify-between items-start max-w-4xl mx-auto relative">
                <!-- Connecting Line -->
                <div class="absolute top-5 md:top-6 left-0 right-0 mx-5 h-1 -translate-y-1/2 z-0">
                    <div class="absolute inset-0 bg-slate-200 rounded-full"></div>
                    <div class="absolute top-0 left-0 h-full bg-primary-500 rounded-full transition-all duration-500" id="progressLine" style="width: 0%"></div>
                </div>

                <!-- Steps -->
                <div class="step-item relative z-10 flex flex-col items-center cursor-pointer group" id="step1" onclick="resetToStep(1)">
                    <div class="w-10 h-10 md:w-12 md:h-12 rounded-full bg-white border-4 border-slate-200 flex items-center justify-center font-bold text-slate-400 transition-all duration-300 group-hover:border-primary-300 step-circle text-sm md:text-base">1</div>
                    <div class="mt-2 md:mt-3 text-xs md:text-sm font-medium text-slate-500 step-label">Date</div>
                </div>
                
                <div class="step-item relative z-10 flex flex-col items-center cursor-pointer group" id="step2" onclick="if(currentStep>1) resetToStep(2)">
                    <div class="w-10 h-10 md:w-12 md:h-12 rounded-full bg-white border-4 border-slate-200 flex items-center justify-center font-bold text-slate-400 transition-all duration-300 group-hover:border-primary-300 step-circle text-sm md:text-base">2</div>
                    <div class="mt-2 md:mt-3 text-xs md:text-sm font-medium text-slate-500 step-label">Ground</div>
                </div>
                
                <div class="step-item relative z-10 flex flex-col items-center cursor-pointer group" id="step3" onclick="if(currentStep>2) resetToStep(3)">
                    <div class="w-10 h-10 md:w-12 md:h-12 rounded-full bg-white border-4 border-slate-200 flex items-center justify-center font-bold text-slate-400 transition-all duration-300 group-hover:border-primary-300 step-circle text-sm md:text-base">3</div>
                    <div class="mt-2 md:mt-3 text-xs md:text-sm font-medium text-slate-500 step-label">Sport & Time</div>
                </div>
                
                <div class="step-item relative z-10 flex flex-col items-center cursor-pointer group" id="step4">
                    <div class="w-10 h-10 md:w-12 md:h-12 rounded-full bg-white border-4 border-slate-200 flex items-center justify-center font-bold text-slate-400 transition-all duration-300 group-hover:border-primary-300 step-circle text-sm md:text-base">4</div>
                    <div class="mt-2 md:mt-3 text-xs md:text-sm font-medium text-slate-500 step-label">Confirm</div>
                </div>
            </div>
        </div>

        <!-- Booking Form Card -->
        <div class="bg-white rounded-3xl shadow-xl border border-slate-100 overflow-hidden min-h-[600px] relative">
            
            <!-- Date Selection Section -->
            <div class="form-section p-6 md:p-12 transition-all duration-500 h-full flex flex-col justify-center" id="dateSection">
                <div class="text-center mb-8 md:mb-10">
                    <div class="w-16 h-16 bg-primary-100 rounded-2xl flex items-center justify-center mx-auto mb-4 text-primary-600">
                        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                    </div>
                    <h2 class="text-2xl font-bold text-slate-900">Select Booking Date</h2>
                    <p class="text-slate-500 mt-2">Choose your preferred date for the booking</p>
                </div>
                
                <div class="max-w-md mx-auto">
                    <label for="dateInput" class="block text-sm font-medium text-slate-700 mb-2">Booking Date</label>
                    <div class="relative">
                        <input type="date" id="dateInput" onclick="this.showPicker()" class="block w-full pl-4 pr-10 py-4 border border-slate-200 rounded-xl text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all bg-slate-50 hover:bg-white cursor-pointer" />
                        <div class="absolute inset-y-0 right-0 pr-4 flex items-center pointer-events-none text-slate-400">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ground Selection Section -->
            <div class="form-section hidden p-6 md:p-12 transition-all duration-500 h-full flex flex-col justify-center" id="groundSection">
                <div class="text-center mb-8 md:mb-10">
                    <div class="w-16 h-16 bg-secondary-100 rounded-2xl flex items-center justify-center mx-auto mb-4 text-secondary-600">
                        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    </div>
                    <h2 class="text-2xl font-bold text-slate-900">Choose Ground</h2>
                    <p class="text-slate-500 mt-2">Pick from available facilities</p>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 max-w-4xl mx-auto">
                    <div class="ground-card group cursor-pointer p-6 md:p-8 min-h-[200px] flex flex-col justify-center rounded-2xl border-2 border-slate-100 hover:border-primary-500 hover:bg-primary-50/30 transition-all duration-300" onclick="selectGround('A', event)">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-2xl font-bold text-slate-900 group-hover:text-primary-700">Ground A</h3>
                            <span class="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center text-slate-400 group-hover:bg-primary-100 group-hover:text-primary-600 transition-colors">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                            </span>
                        </div>
                        <div class="flex flex-wrap gap-2">
                            <span class="px-3 py-1 rounded-lg bg-slate-100 text-slate-600 text-sm font-medium">Handball</span>
                            <span class="px-3 py-1 rounded-lg bg-slate-100 text-slate-600 text-sm font-medium">Volleyball</span>
                            <span class="px-3 py-1 rounded-lg bg-slate-100 text-slate-600 text-sm font-medium">Cricket</span>
                            <span class="px-3 py-1 rounded-lg bg-slate-100 text-slate-600 text-sm font-medium">Basketball</span>
                        </div>
                    </div>
                    
                    <div class="ground-card group cursor-pointer p-6 md:p-8 min-h-[200px] flex flex-col justify-center rounded-2xl border-2 border-slate-100 hover:border-primary-500 hover:bg-primary-50/30 transition-all duration-300" onclick="selectGround('B', event)">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-2xl font-bold text-slate-900 group-hover:text-primary-700">Ground B</h3>
                            <span class="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center text-slate-400 group-hover:bg-primary-100 group-hover:text-primary-600 transition-colors">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                            </span>
                        </div>
                        <div class="flex flex-wrap gap-2">
                            <span class="px-3 py-1 rounded-lg bg-slate-100 text-slate-600 text-sm font-medium">Football</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sport & Time Selection Section -->
            <div class="form-section hidden p-6 md:p-12 transition-all duration-500 h-full flex flex-col justify-center" id="sportTimeSection">
                <div class="text-center mb-8 md:mb-10">
                    <div class="w-16 h-16 bg-purple-100 rounded-2xl flex items-center justify-center mx-auto mb-4 text-purple-600">
                        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    </div>
                    <h2 class="text-2xl font-bold text-slate-900">Sport & Time</h2>
                    <p class="text-slate-500 mt-2">Select sport and time slot</p>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
                    <div class="sports-section">
                        <h3 class="text-lg font-bold text-slate-900 mb-4 flex items-center gap-2">
                            <span class="w-6 h-6 rounded-full bg-primary-100 text-primary-600 flex items-center justify-center text-xs">1</span>
                            Available Sports
                        </h3>
                        <div class="grid grid-cols-2 gap-4" id="sportsGrid"></div>
                    </div>
                    
                    <div class="time-section">
                        <h3 class="text-lg font-bold text-slate-900 mb-4 flex items-center gap-2">
                            <span class="w-6 h-6 rounded-full bg-primary-100 text-primary-600 flex items-center justify-center text-xs">2</span>
                            Available Time Slots
                        </h3>
                        <div class="grid grid-cols-2 sm:grid-cols-3 gap-4" id="slotsGrid"></div>
                    </div>
                </div>

                <!-- Equipment Section -->
                <div id="equipmentSection" class="mt-12 pt-8 border-t border-slate-100 hidden">
                    <h3 class="text-lg font-bold text-slate-900 mb-4">Equipment Requirements</h3>
                    <label class="flex items-center gap-3 cursor-pointer mb-4 group">
                        <div class="relative">
                            <input type="checkbox" id="equipmentCheckbox" checked class="peer sr-only">
                            <div class="w-11 h-6 bg-slate-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary-600"></div>
                        </div>
                        <span class="text-slate-700 font-medium group-hover:text-primary-600 transition-colors">Need equipment?</span>
                    </label>
                    <div id="equipmentField" class="equipment-field">
                        <textarea id="equipmentInput" class="w-full p-4 border border-slate-200 rounded-xl bg-slate-50 text-slate-700 focus:outline-none focus:ring-2 focus:ring-primary-500 transition-all resize-none h-32" placeholder="Specify equipment needed..." readonly></textarea>
                    </div>
                </div>
            </div>

            <!-- Confirmation Section -->
            <div class="form-section hidden p-6 md:p-12 transition-all duration-500 h-full flex flex-col justify-center" id="confirmSection">
                <div class="text-center mb-8 md:mb-10">
                    <div class="w-16 h-16 bg-green-100 rounded-2xl flex items-center justify-center mx-auto mb-4 text-green-600">
                        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    </div>
                    <h2 class="text-2xl font-bold text-slate-900">Confirm Your Booking</h2>
                    <p class="text-slate-500 mt-2">Review your booking details before submitting</p>
                </div>
                
                <div class="max-w-2xl mx-auto">
                    <div class="bg-slate-50 rounded-2xl p-6 md:p-8 border border-slate-200 mb-8">
                        <h3 class="text-lg font-bold text-slate-900 mb-6 border-b border-slate-200 pb-4">Booking Summary</h3>
                        <div class="space-y-4">
                            <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-1 sm:gap-4">
                                <span class="text-slate-500">Date</span>
                                <strong id="summaryDate" class="text-slate-900 font-semibold text-left sm:text-right">Not selected</strong>
                            </div>
                            <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-1 sm:gap-4">
                                <span class="text-slate-500">Facility</span>
                                <strong id="summaryGround" class="text-slate-900 font-semibold text-left sm:text-right">Not selected</strong>
                            </div>
                            <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-1 sm:gap-4">
                                <span class="text-slate-500">Sport</span>
                                <strong id="summarySport" class="text-slate-900 font-semibold text-left sm:text-right">Not selected</strong>
                            </div>
                            <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-1 sm:gap-4">
                                <span class="text-slate-500 shrink-0">Time Slot</span>
                                <strong id="summaryTime" class="text-slate-900 font-semibold text-left sm:text-right">Not selected</strong>
                            </div>
                        </div>
                    </div>
                    
                    <button class="w-full py-4 px-6 bg-primary-600 text-white font-bold rounded-xl shadow-lg shadow-primary-600/30 hover:bg-primary-700 hover:shadow-primary-600/50 hover:-translate-y-1 transition-all flex items-center justify-center gap-2" onclick="submitBooking()">
                        <span>Proceed to Book</span>
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
let bookingData = { date: '', ground: '', sport: '', timeSlot: '', equipment: 'Yes' };
let currentStep = 1;

const groundSports = {
    'A': [
        { name: 'Handball', icon: 'ü§æ' },
        { name: 'Volleyball', icon: 'üèê' },
        { name: 'Cricket', icon: 'üèè' },
        { name: 'Basketball', icon: 'üèÄ' }
    ],
    'B': [
        { name: 'Football', icon: '‚öΩ' }
    ]
};

// Initialize dashboard
document.addEventListener('DOMContentLoaded', function() {
  const dateInput = document.getElementById('dateInput');
  const today = new Date();
  const minDateStr = today.toISOString().split('T')[0];
  if (dateInput) dateInput.min = minDateStr;

  if (dateInput) {
    dateInput.addEventListener('change', function() {
      bookingData.date = this.value;
      if (this.value) { nextStep(); }
      updateSummary();
    });
  }

    // Equipment checkbox listener
    const equipmentCheckbox = document.getElementById('equipmentCheckbox');
    if (equipmentCheckbox) {
        equipmentCheckbox.addEventListener('change', function() {
            const field = document.getElementById('equipmentField');
            if (this.checked) {
                field.style.display = "block";
                bookingData.equipment = 'Yes';
            } else {
                field.style.display = "none";
                bookingData.equipment = 'No';
            }
            updateSummary();
        });
    }
});

function updateStepIndicators() {
    // Update step indicators
    for (let i = 1; i <= 4; i++) {
        const stepElement = document.getElementById(`step${i}`);
        const circle = stepElement.querySelector('.step-circle');
        const label = stepElement.querySelector('.step-label');
        
        if (i <= currentStep) {
            circle.classList.remove('bg-white', 'border-slate-200', 'text-slate-400');
            circle.classList.add('bg-primary-600', 'border-primary-600', 'text-white');
            label.classList.remove('text-slate-500');
            label.classList.add('text-primary-600', 'font-bold');
        } else {
            circle.classList.add('bg-white', 'border-slate-200', 'text-slate-400');
            circle.classList.remove('bg-primary-600', 'border-primary-600', 'text-white');
            label.classList.add('text-slate-500');
            label.classList.remove('text-primary-600', 'font-bold');
        }
    }
    
    // Update progress line
    const progressLine = document.getElementById('progressLine');
    const progress = ((currentStep - 1) / 3) * 100;
    progressLine.style.width = `${progress}%`;

    // Update form sections
    const sections = ['dateSection', 'groundSection', 'sportTimeSection', 'confirmSection'];
    sections.forEach((sectionId, index) => {
        const section = document.getElementById(sectionId);
        if (index + 1 === currentStep) {
            section.classList.remove('hidden');
            // Add fade in animation
            section.style.opacity = '0';
            setTimeout(() => section.style.opacity = '1', 50);
        } else {
            section.classList.add('hidden');
        }
    });
}

function nextStep() {
    if (currentStep < 4) {
        currentStep++;
        updateStepIndicators();
    }
}

function resetToStep(step) {
    currentStep = step;
    updateStepIndicators();
    
    // Reset subsequent data
  if (step <= 1) {
    bookingData = { date: '', ground: '', sport: '', timeSlot: '', equipment: 'Yes' };
    } else if (step <= 2) {
        bookingData.ground = '';
        bookingData.sport = '';
        bookingData.timeSlot = '';
    } else if (step <= 3) {
        bookingData.sport = '';
        bookingData.timeSlot = '';
    }
    
    updateSummary();
}

function selectGround(ground, event) {
    bookingData.ground = ground;
    bookingData.sport = '';
    bookingData.timeSlot = '';

    // Update UI
    document.querySelectorAll('.ground-card').forEach(c => {
        c.classList.remove('border-primary-500', 'bg-primary-50/30', 'ring-2', 'ring-primary-500', 'ring-offset-2');
        c.classList.add('border-slate-100');
    });
    event.currentTarget.classList.remove('border-slate-100');
    event.currentTarget.classList.add('border-primary-500', 'bg-primary-50/30', 'ring-2', 'ring-primary-500', 'ring-offset-2');

    // Populate sports for this ground
    populateSports(ground);
    
    // Move to next step
    setTimeout(() => {
        nextStep();
    }, 500);

    updateSummary();
}

function populateSports(ground) {
    const grid = document.getElementById('sportsGrid');
    grid.innerHTML = '';
    groundSports[ground].forEach(s => {
        const btn = document.createElement('button');
        btn.className = 'sport-option w-full p-5 rounded-xl border-2 border-slate-200 hover:border-primary-500 hover:bg-primary-50 transition-all text-left font-semibold text-slate-700 flex items-center gap-3';
        btn.innerHTML = `<span class="text-2xl">${s.icon}</span> ${s.name}`;
        btn.onclick = (e) => selectSport(s.name, e);
        grid.appendChild(btn);
    });
}

function selectSport(sport, event) {
    bookingData.sport = sport;
    document.querySelectorAll('.sport-option').forEach(o => {
        o.classList.remove('border-primary-600', 'bg-primary-50', 'text-primary-700', 'ring-2', 'ring-primary-500', 'ring-offset-2');
        o.classList.add('border-slate-200', 'text-slate-700');
    });
    event.currentTarget.classList.remove('border-slate-200', 'text-slate-700');
    event.currentTarget.classList.add('border-primary-600', 'bg-primary-50', 'text-primary-700', 'ring-2', 'ring-primary-500', 'ring-offset-2');

    // Show equipment section
    const equipSection = document.getElementById('equipmentSection');
    const equipInput = document.getElementById('equipmentInput');
    equipSection.classList.remove('hidden');

    // Autofill equipment text
    if (sport === "Football") {
        equipInput.value = "1. Football\n2. Cones and Marker";
    } else if (sport === "Cricket") {
        equipInput.value = "Stumps";
    } else {
        equipInput.value = sport;
    }

    // Fetch available time slots
    if (bookingData.ground && bookingData.date) {
        fetchAvailability(bookingData.ground);
    }

    updateSummary();
}

function selectTimeSlot(slot, event) {
    bookingData.timeSlot = slot;
    document.querySelectorAll('.time-slot').forEach(s => {
        s.classList.remove('bg-primary-600', 'text-white', 'border-primary-600', 'ring-2', 'ring-primary-500', 'ring-offset-2');
        if(!s.classList.contains('booked') && !s.classList.contains('freeze')) {
            s.classList.add('bg-white', 'text-slate-700', 'border-slate-200');
        }
    });
    event.currentTarget.classList.remove('bg-white', 'text-slate-700', 'border-slate-200');
    event.currentTarget.classList.add('bg-primary-600', 'text-white', 'border-primary-600', 'ring-2', 'ring-primary-500', 'ring-offset-2');
    
    updateSummary();
    
    // Move to confirmation step
    setTimeout(() => {
        nextStep();
    }, 500);
}

async function fetchAvailability(ground) {
  const date = bookingData.date;
  const sport = bookingData.sport;
  if (!date || !sport) return;

  const grid = document.getElementById('slotsGrid');
  grid.innerHTML = '<div class="col-span-full text-center py-8 text-slate-500">Loading available slots...</div>';

  try {
  const params = new URLSearchParams({ ground, date, sport });
    const res = await fetch(`/check-availability/?${params.toString()}`);
    if (!res.ok) throw new Error('Network error');
    const data = await res.json();

    grid.innerHTML = '';
    (data.slots || []).forEach(({ time, status }) => {
      const slotDiv = document.createElement('div');
      // Base classes
      let classes = 'time-slot p-4 rounded-xl border-2 text-center font-medium transition-all cursor-pointer';
      
      if (status === 'available') {
        classes += ' bg-white border-slate-200 hover:border-primary-500 hover:bg-primary-50 text-slate-700';
        slotDiv.onclick = (e) => selectTimeSlot(time, e);
      } else if (status === 'booked') {
        classes += ' bg-red-50 border-red-100 text-red-400 cursor-not-allowed opacity-60 booked';
      } else { // freeze
        classes += ' bg-slate-100 border-slate-200 text-slate-400 cursor-not-allowed freeze';
      }
      
      slotDiv.className = classes;
      slotDiv.textContent = time.replace(/^0/, ''); // light fmt tweak
      
      grid.appendChild(slotDiv);
    });
  } catch (error) {
    console.error('Error fetching availability:', error);
    grid.innerHTML = '<div class="col-span-full text-center py-8 text-red-500">Error loading slots. Please try again.</div>';
  }
}

function updateSummary() {
    document.getElementById('summaryDate').textContent = bookingData.date || 'Not selected';
  document.getElementById('summaryGround').textContent = bookingData.ground ? `Ground ${bookingData.ground}` : 'Not selected';
    document.getElementById('summarySport').textContent = bookingData.sport || 'Not selected';
    document.getElementById('summaryTime').textContent = bookingData.timeSlot ? `Morning Session (${bookingData.timeSlot})` : 'Not selected';
}

async function submitBooking() {
    if (!bookingData.date || !bookingData.ground || !bookingData.sport || !bookingData.timeSlot) {
        alert('Please complete all required fields before submitting.');
        return;
    }

    try {
    // Redirect to Django student booking form with prefilled details via query params
    const params = new URLSearchParams({
      date: bookingData.date,
      ground: bookingData.ground,
      sport: bookingData.sport,
      time_slot: bookingData.timeSlot,
      equipment: bookingData.equipment
    });
    window.location.href = `/student/booking/?${params.toString()}`;
    } catch (error) {
        console.error('Error:', error);
        alert('Error submitting booking. Please try again.');
    }
}

// Initialize the dashboard
updateStepIndicators();
</script>
{% endblock %}

{% block footer %}
<!-- No footer on dashboard -->
{% endblock %}